{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\Shachar\\\\Desktop\\\\P\\\\reactHomeals\\\\src\\\\UserContext.js\";\nimport fire from \"../fire\";\nimport { auth } from 'firebase';\nimport React, { useContext, useState, useEffect } from 'react';\nimport dbFirestore from \"../fire\";\nimport { getDistanceFromLatLonInKm } from \"../helpers/calcDis\";\nvar apiURLgetUser = \"http://192.168.31.156:50247/api/User/getUser/\";\nvar apiURLpostUser = \"http://192.168.31.156:50247/api/User/postUser/\";\nvar apiURLgetChefs = \"http://192.168.31.156:50247/api/Chef/getChefs/\";\nvar UserContext = React.createContext();\nvar UserUpdateContext = React.createContext();\nexport function useUserContext() {\n  return useContext(UserContext);\n}\nexport function useUserUpdateContext() {\n  return useContext(UserUpdateContext);\n}\nexport function UserProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState({\n    value: ''\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      currentUser = _useState2[0],\n      setCurrentUser = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      chefsArr = _useState4[0],\n      setChefsArr = _useState4[1];\n\n  var _useState5 = useState({\n    value: '',\n    error: ''\n  }),\n      _useState6 = _slicedToArray(_useState5, 2),\n      name = _useState6[0],\n      setName = _useState6[1];\n\n  var _useState7 = useState({\n    value: '',\n    error: ''\n  }),\n      _useState8 = _slicedToArray(_useState7, 2),\n      email = _useState8[0],\n      setEmail = _useState8[1];\n\n  var _useState9 = useState({\n    value: '',\n    error: ''\n  }),\n      _useState10 = _slicedToArray(_useState9, 2),\n      password = _useState10[0],\n      setPassword = _useState10[1];\n\n  var _useState11 = useState(''),\n      _useState12 = _slicedToArray(_useState11, 2),\n      userID = _useState12[0],\n      setUserID = _useState12[1];\n\n  function onLogin(email, userID) {\n    setEmail(email);\n    setUserID(userID);\n  }\n\n  function updateEmail(email) {\n    return currentUser.updateEmail(email);\n  }\n\n  function updatePassword(password) {\n    return currentUser.updatePassword(password);\n  }\n\n  function signup(firstName, lastName, city, phone, email, password, lon, lat) {\n    var flag;\n    return _regeneratorRuntime.async(function signup$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            flag = true;\n            console.log('here, lat:' + lat);\n            _context.next = 4;\n            return _regeneratorRuntime.awrap(fire.auth().createUserWithEmailAndPassword(email, password).then(function (user) {\n              console.log(\"hi1\");\n              console.log(user.user.uid + \" / \" + email + \" / \" + firstName + \" / \" + lastName + \" / \" + city + \" / \" + phone);\n              var newUser = {\n                uid: user.user.uid,\n                email: email,\n                firstName: firstName,\n                lastName: lastName,\n                city: city,\n                pNumber: phone,\n                lon: lon,\n                lat: lat\n              };\n              console.log(\"bye2\");\n              fetch(apiURLpostUser, {\n                method: 'POST',\n                body: JSON.stringify(newUser),\n                headers: new Headers({\n                  'Content-Type': 'application/json; charset=UTF-8',\n                  'Accept': 'application/json; charset=UTF-8'\n                })\n              }).then(function (response) {\n                console.log('response=', response);\n                console.log('response.status', response.status);\n                console.log('response.ok', response.ok);\n                return response.json();\n              });\n            }).catch(function (err) {\n              switch (err.code) {\n                case \"auth/email-already-in-use\":\n                case \"auth/invalid-email\":\n                case \"auth/weak-password\":\n                  alert(err.message);\n                  flag = false;\n                  break;\n              }\n            }));\n\n          case 4:\n            if (flag) {\n              setDbUser();\n            }\n\n            return _context.abrupt(\"return\", flag);\n\n          case 6:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function setDbUser() {\n    return _regeneratorRuntime.async(function setDbUser$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function signin(email, password, callbackfunc) {\n    var flag;\n    return _regeneratorRuntime.async(function signin$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            fire.auth().signInWithEmailAndPassword(email, password).then(function _callee3() {\n              return _regeneratorRuntime.async(function _callee3$(_context5) {\n                while (1) {\n                  switch (_context5.prev = _context5.next) {\n                    case 0:\n                      _context5.next = 2;\n                      return _regeneratorRuntime.awrap(fire.auth().onAuthStateChanged(function _callee2(authUser) {\n                        return _regeneratorRuntime.async(function _callee2$(_context4) {\n                          while (1) {\n                            switch (_context4.prev = _context4.next) {\n                              case 0:\n                                if (!(authUser !== null)) {\n                                  _context4.next = 8;\n                                  break;\n                                }\n\n                                console.log(authUser);\n                                _context4.next = 4;\n                                return _regeneratorRuntime.awrap(fetch(apiURLgetUser + authUser.uid, {\n                                  method: 'GET',\n                                  headers: new Headers({\n                                    'Content-Type': 'application/json; charset=UTF-8',\n                                    'Accept': 'application/json; charset=UTF-8'\n                                  })\n                                }).then(function (response) {\n                                  console.log('response=', response);\n                                  console.log('response.status', response.status);\n                                  console.log('response.ok', response.ok);\n                                  return response.json();\n                                }).then(function _callee(data) {\n                                  var user;\n                                  return _regeneratorRuntime.async(function _callee$(_context3) {\n                                    while (1) {\n                                      switch (_context3.prev = _context3.next) {\n                                        case 0:\n                                          user = {\n                                            uid: data.Uid,\n                                            email: data.Email,\n                                            firstName: data.FirstName,\n                                            lastName: data.LastName,\n                                            city: data.City,\n                                            pNumber: data.PNumber,\n                                            lon: data.Lon,\n                                            lat: data.Lat\n                                          };\n                                          _context3.next = 3;\n                                          return _regeneratorRuntime.awrap(setCurrentUser(user));\n\n                                        case 3:\n                                          flag = true;\n\n                                        case 4:\n                                        case \"end\":\n                                          return _context3.stop();\n                                      }\n                                    }\n                                  }, null, null, null, Promise);\n                                }, function (error) {\n                                  console.log(\"err get=\", error);\n                                }));\n\n                              case 4:\n                                _context4.next = 6;\n                                return _regeneratorRuntime.awrap(fetch(apiURLgetChefs, {\n                                  method: 'GET',\n                                  headers: new Headers({\n                                    'Content-Type': 'application/json; charset=UTF-8',\n                                    'Accept': 'application/json; charset=UTF-8'\n                                  })\n                                }).then(function (response) {\n                                  console.log('response=', response);\n                                  console.log('response.status', response.status);\n                                  console.log('response.ok', response.ok);\n                                  return response.json();\n                                }).then(function (data) {\n                                  var tempChefs = [];\n                                  data.forEach(function (element) {\n                                    var chef = {\n                                      Address: element.Address,\n                                      DisplayName: element.DisplayName,\n                                      Email: element.Email,\n                                      FirstName: element.FirstName,\n                                      LastName: element.LastName,\n                                      PNumber: element.PNumber,\n                                      Lon: element.Lon,\n                                      Lat: element.Lat,\n                                      Rating: element.Rating,\n                                      FoodType: element.FoodType,\n                                      Img: element.Img,\n                                      DisFromUser: getDistanceFromLatLonInKm(currentUser.lat, currentUser.lon, element.Lat, element.Lon)\n                                    };\n                                    tempChefs.push(chef);\n                                    console.log(currentUser.lat);\n                                  });\n                                  setChefsArr(tempChefs);\n                                  callbackfunc(flag);\n                                }, function (error) {\n                                  console.log(\"err get=\", error);\n                                }));\n\n                              case 6:\n                                _context4.next = 10;\n                                break;\n\n                              case 8:\n                                setCurrentUser('');\n                                console.log(currentUser);\n\n                              case 10:\n                              case \"end\":\n                                return _context4.stop();\n                            }\n                          }\n                        }, null, null, null, Promise);\n                      }));\n\n                    case 2:\n                    case \"end\":\n                      return _context5.stop();\n                  }\n                }\n              }, null, null, null, Promise);\n            }).catch(function (err) {\n              switch (err.code) {\n                case \"auth/invalid-email\":\n                case \"auth/user-disabled\":\n                case \"auth/user-not-found\":\n                  alert(\"wrong Email\");\n                  console.log(err.message);\n                  break;\n\n                case \"auth/wrong-password\":\n                  alert(\"wrong Password\");\n                  console.log(err.message);\n                  break;\n              }\n\n              flag = false;\n              callbackfunc(flag);\n            });\n\n          case 1:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  }\n\n  function Logout() {\n    fire.auth().signOut();\n  }\n\n  var value = {\n    currentUser: currentUser,\n    setCurrentUser: setCurrentUser,\n    name: name,\n    email: email,\n    password: password,\n    userID: userID,\n    signup: signup,\n    signin: signin,\n    updateEmail: updateEmail,\n    updatePassword: updatePassword,\n    onLogin: onLogin,\n    Logout: Logout,\n    chefsArr: chefsArr\n  };\n  return React.createElement(UserContext.Provider, {\n    value: value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 9\n    }\n  }, children);\n}","map":{"version":3,"sources":["C:/Users/Shachar/Desktop/P/reactHomeals/src/UserContext.js"],"names":["fire","auth","React","useContext","useState","useEffect","dbFirestore","getDistanceFromLatLonInKm","apiURLgetUser","apiURLpostUser","apiURLgetChefs","UserContext","createContext","UserUpdateContext","useUserContext","useUserUpdateContext","UserProvider","children","value","currentUser","setCurrentUser","chefsArr","setChefsArr","error","name","setName","email","setEmail","password","setPassword","userID","setUserID","onLogin","updateEmail","updatePassword","signup","firstName","lastName","city","phone","lon","lat","flag","console","log","createUserWithEmailAndPassword","then","user","uid","newUser","pNumber","fetch","method","body","JSON","stringify","headers","Headers","response","status","ok","json","catch","err","code","alert","message","setDbUser","signin","callbackfunc","signInWithEmailAndPassword","onAuthStateChanged","authUser","data","Uid","Email","FirstName","LastName","City","PNumber","Lon","Lat","tempChefs","forEach","element","chef","Address","DisplayName","Rating","FoodType","Img","DisFromUser","push","Logout","signOut"],"mappings":"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","sourcesContent":["import fire from '../fire'\r\nimport { auth } from 'firebase'\r\nimport React, { useContext, useState, useEffect } from 'react'\r\nimport dbFirestore from '../fire'\r\nimport { getDistanceFromLatLonInKm } from '../helpers/calcDis'\r\n\r\nlet apiURLgetUser = \"http://192.168.31.156:50247/api/User/getUser/\";\r\nlet apiURLpostUser = \"http://192.168.31.156:50247/api/User/postUser/\";\r\nlet apiURLgetChefs = \"http://192.168.31.156:50247/api/Chef/getChefs/\";\r\n\r\n\r\nconst UserContext = React.createContext()\r\nconst UserUpdateContext = React.createContext()\r\n\r\nexport function useUserContext() {\r\n    return useContext(UserContext)\r\n}\r\n\r\nexport function useUserUpdateContext() {\r\n    return useContext(UserUpdateContext)\r\n}\r\n\r\nexport function UserProvider({ children }) {\r\n    const [currentUser, setCurrentUser] = useState({ value: '' })\r\n    const [chefsArr, setChefsArr] = useState('')\r\n    const [name, setName] = useState({ value: '', error: '' })\r\n    const [email, setEmail] = useState({ value: '', error: '' })\r\n    const [password, setPassword] = useState({ value: '', error: '' })\r\n    const [userID, setUserID] = useState('')\r\n\r\n    function onLogin(email, userID) {\r\n        setEmail(email);\r\n        setUserID(userID);\r\n    }\r\n\r\n    function updateEmail(email) {\r\n        return currentUser.updateEmail(email)\r\n    }\r\n\r\n    function updatePassword(password) {\r\n        return currentUser.updatePassword(password)\r\n    }\r\n\r\n    async function signup(firstName, lastName, city, phone, email, password, lon, lat) {\r\n        var flag = true;\r\n        console.log('here, lat:' + lat)\r\n        await fire\r\n            .auth()\r\n            .createUserWithEmailAndPassword(email, password)\r\n            .then(function (user) {\r\n                console.log(\"hi1\")\r\n                console.log(user.user.uid + \" / \" + email + \" / \" + firstName + \" / \" + lastName + \" / \" + city + \" / \" + phone)\r\n                const newUser = {\r\n                    uid: user.user.uid,\r\n                    email: email,\r\n                    firstName: firstName,\r\n                    lastName: lastName,\r\n                    city: city,\r\n                    pNumber: phone,\r\n                    lon: lon,\r\n                    lat: lat\r\n                }\r\n                console.log(\"bye2\")\r\n                fetch(apiURLpostUser, {\r\n                    method: 'POST',\r\n                    body: JSON.stringify(newUser),\r\n                    headers: new Headers({\r\n                        'Content-Type': 'application/json; charset=UTF-8',\r\n                        'Accept': 'application/json; charset=UTF-8'\r\n                    })\r\n                })\r\n                    .then(response => {\r\n                        console.log('response=', response);\r\n                        console.log('response.status', response.status);\r\n                        console.log('response.ok', response.ok);\r\n                        return response.json();\r\n                    })\r\n            })\r\n            .catch(err => {\r\n                switch (err.code) {\r\n                    case \"auth/email-already-in-use\":\r\n                    case \"auth/invalid-email\":\r\n                    case \"auth/weak-password\":\r\n                        alert(err.message);\r\n                        flag = false;\r\n                        break;\r\n                }\r\n            });\r\n        if (flag) {\r\n            setDbUser()\r\n        }\r\n\r\n        return flag;\r\n    }\r\n\r\n    async function setDbUser(/*,,lastName,,city,street,number, */) {\r\n        /* console.log()\r\n        const users = await dbFirestore\r\n             .firestore()\r\n            .collection('userData')\r\n            .doc(currentUser.uid)\r\n            .set({\r\n             \r\n                email: currentUser.email,\r\n            })\r\n            .then(() => {\r\n                console.log('User added!');\r\n            });  */\r\n\r\n    }\r\n\r\n\r\n    async function signin(email, password, callbackfunc) {\r\n        let flag;\r\n        fire.auth()\r\n            .signInWithEmailAndPassword(email, password)\r\n            .then(async () => {\r\n                await fire.auth().onAuthStateChanged(async authUser => {\r\n                    if (authUser !== null) {\r\n                        console.log(authUser)\r\n                        /* Get User Details from SQL */\r\n                        await fetch(apiURLgetUser + authUser.uid, {\r\n                            method: 'GET',\r\n                            headers: new Headers({\r\n                                'Content-Type': 'application/json; charset=UTF-8',\r\n                                'Accept': 'application/json; charset=UTF-8'\r\n                            })\r\n                        })\r\n                            .then(response => {\r\n                                console.log('response=', response);\r\n                                console.log('response.status', response.status);\r\n                                console.log('response.ok', response.ok);\r\n                                return response.json();\r\n                            })\r\n                            .then(async(data) => {\r\n                                const user = {\r\n                                    uid: data.Uid,\r\n                                    email: data.Email,\r\n                                    firstName: data.FirstName,\r\n                                    lastName: data.LastName,\r\n                                    city: data.City,\r\n                                    pNumber: data.PNumber,\r\n                                    lon: data.Lon,\r\n                                    lat: data.Lat\r\n                                }\r\n                                await setCurrentUser(user);\r\n                                flag = true;\r\n                            },\r\n                                (error) => {\r\n                                    console.log(\"err get=\", error);\r\n                                });\r\n\r\n                        /* Get Chefs from SQL */\r\n                        await fetch(apiURLgetChefs, {\r\n                            method: 'GET',\r\n                            headers: new Headers({\r\n                                'Content-Type': 'application/json; charset=UTF-8',\r\n                                'Accept': 'application/json; charset=UTF-8'\r\n                            })\r\n                        })\r\n                            .then(response => {\r\n                                console.log('response=', response);\r\n                                console.log('response.status', response.status);\r\n                                console.log('response.ok', response.ok);\r\n                                return response.json();\r\n                            })\r\n                            .then((data) => {\r\n                                let tempChefs = [];\r\n                                data.forEach(element => {\r\n                                    const chef = {\r\n                                        Address: element.Address,\r\n                                        DisplayName: element.DisplayName,\r\n                                        Email: element.Email,\r\n                                        FirstName: element.FirstName,\r\n                                        LastName: element.LastName,\r\n                                        PNumber: element.PNumber,\r\n                                        Lon: element.Lon,\r\n                                        Lat: element.Lat,\r\n                                        Rating: element.Rating,\r\n                                        FoodType: element.FoodType,\r\n                                        Img: element.Img,\r\n                                        DisFromUser: getDistanceFromLatLonInKm(currentUser.lat, currentUser.lon, element.Lat, element.Lon)\r\n                                    }\r\n                                    tempChefs.push(chef);\r\n                                    console.log(currentUser.lat)\r\n                                });\r\n                                setChefsArr(tempChefs);\r\n                                callbackfunc(flag);\r\n                            },\r\n                                (error) => {\r\n                                    console.log(\"err get=\", error);\r\n                                });\r\n\r\n                    }\r\n                    else {\r\n                        setCurrentUser('');\r\n                        console.log(currentUser)\r\n                    }\r\n                })\r\n            }\r\n            )\r\n            .catch(err => {\r\n                switch (err.code) {\r\n                    case \"auth/invalid-email\":\r\n                    case \"auth/user-disabled\":\r\n                    case \"auth/user-not-found\":\r\n                        alert(\"wrong Email\");\r\n                        console.log(err.message)\r\n                        break;\r\n                    case \"auth/wrong-password\":\r\n                        alert(\"wrong Password\");\r\n                        console.log(err.message)\r\n                        break;\r\n                }\r\n                flag = false;\r\n                callbackfunc(flag);\r\n            });\r\n    }\r\n\r\n    function Logout() {\r\n        fire.auth().signOut();\r\n    }\r\n\r\n    /* useEffect(() => {\r\n        const unsubscribe = fire.auth().onAuthStateChanged(user => {\r\n            setCurrentUser(user)\r\n            console.log(user)\r\n        })\r\n\r\n        return unsubscribe\r\n    }, []) */\r\n\r\n    const value = {\r\n        currentUser,\r\n        setCurrentUser,\r\n        name,\r\n        email,\r\n        password,\r\n        userID,\r\n        signup,\r\n        signin,\r\n        updateEmail,\r\n        updatePassword,\r\n        onLogin,\r\n        Logout,\r\n        chefsArr\r\n    }\r\n\r\n    return (\r\n        <UserContext.Provider value={value}>\r\n            {children}\r\n        </UserContext.Provider>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}